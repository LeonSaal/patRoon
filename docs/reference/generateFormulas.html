<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Automatic chemical formula generation — generateFormulas • patRoon</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Automatic chemical formula generation — generateFormulas" />
<meta property="og:description" content="Automatically calculate chemical formulae for all feature groups." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patRoon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Reference
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../reference/index.html">Online</a>
    </li>
    <li>
      <a href="../reference/patRoon.pdf">PDF</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/tutorial.html">Online HTML page</a>
    </li>
    <li>
      <a href="../articles/tutorial.pdf">PDF</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Handbook
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../handbook_bd/index.html">Book format</a>
    </li>
    <li>
      <a href="../handbook_bd/handbook.pdf">PDF</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rickhelmus/patRoon">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Automatic chemical formula generation</h1>
    <small class="dont-index">Source: <a href='https://github.com/rickhelmus/patRoon/blob/master/R/formulas.R'><code>R/formulas.R</code></a></small>
    <div class="hidden name"><code>generateFormulas.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Automatically calculate chemical formulae for all feature groups.</p>
    </div>

    <pre class="usage"><span class='co'># S4 method for featureGroups</span>
<span class='fu'>generateFormulas</span><span class='op'>(</span><span class='va'>fGroups</span>, <span class='va'>MSPeakLists</span>, <span class='va'>algorithm</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>fGroups</th>
      <td><p><code><a href='featureGroups-class.html'>featureGroups</a></code> object for which formulae should be generated. This should be the same or
a subset of the object that was used to create the specified <code>MSPeakLists</code>. In the case of a subset only the
remaining feature groups in the subset are considered.</p></td>
    </tr>
    <tr>
      <th>MSPeakLists</th>
      <td><p>An <code><a href='MSPeakLists-class.html'>MSPeakLists</a></code> object that was generated for the supplied <code>fGroups</code>.</p></td>
    </tr>
    <tr>
      <th>algorithm</th>
      <td><p>A character string describing the algorithm that should be
used: <code>"bruker"</code>, <code>"genform"</code>, <code>"sirius"</code></p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Any parameters to be passed to the selected formula generation algorithm.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code><a href='formulas-class.html'>formulas</a></code> object containing all generated formulae.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Several algorithms are provided to automatically generate formulae for given feature groups. All algorithms use the
accurate mass of a feature to back-calculate candidate formulae. Depending on the algorithm and data availability,
other data such as isotopic pattern and MS/MS fragments may be used to further improve formula assignment and
ranking.</p>
<p><code>generateFormulas</code> is a generic function that will generateFormulas by one of the supported algorithms. The actual
  functionality is provided by algorithm specific functions such as <code>generateFormulasDA</code> and <code>generateFormulasGenForm</code>. While these
  functions may be called directly, <code>generateFormulas</code> provides a generic interface and is therefore usually preferred.</p>
    <h2 class="hasAnchor" id="candidate-assignment"><a class="anchor" href="#candidate-assignment"></a>Candidate assignment</h2>

    <p>Formula candidate assignment occurs in one of the following ways:</p><ul>
<li><p>Candidates are first generated for each feature and then pooled to form consensus candidates for the feature
  group.</p></li>
<li><p>Candidates are directly generated for each feature group by group averaged MS peak list data.</p></li>
</ul>

<p>With approach (1), scorings and mass errors are averaged and outliers are removed (controlled by
  <code>featThreshold</code> and <code>featThresholdAnn</code> arguments). Other candidate properties that cannot be averaged are
  from the feature from the analysis as specified in the <code>"analysis"</code> column of the results. The second approach only generates candidate formulae once for every feature group, and is therefore generally much
  faster. However, this inherently prevents removal of outliers.</p>
<p>Note that with either approach subsequent workflow steps that use formula data (<em>e.g.</em>
  <code><a href='compounds-class.html'>addFormulaScoring</a></code> and <a href='reporting.html'>reporting</a> functions) only use formula data that was eventually assigned
  to feature groups.</p>
    <h2 class="hasAnchor" id="scorings"><a class="anchor" href="#scorings"></a>Scorings</h2>

    <p>Each algorithm implements their own scoring system. Their names have been harmonized where
  possible. An overview is obtained with the <code><a href='formulaScorings.html'>formulaScorings</a></code> function:
  <table class='table'>
<tr><td><strong>name</strong></td><td><strong>genform</strong></td><td><strong>sirius</strong></td><td><strong>bruker</strong></td><td><strong>description</strong></td></tr>
<tr><td>combMatch</td><td>comb_match</td><td>-</td><td>-</td><td>MS and MS/MS combined match value</td></tr>
<tr><td>isoScore</td><td>MS_match</td><td>isoScore</td><td>-</td><td>How well the isotopic pattern matches</td></tr>
<tr><td>mSigma</td><td>-</td><td>-</td><td>mSigma</td><td>Deviation of the isotopic pattern</td></tr>
<tr><td>MSMSScore</td><td>MSMS_match</td><td>treeScore</td><td>-</td><td>How well MS/MS data matches</td></tr>
<tr><td>score</td><td>-</td><td>score</td><td>Score</td><td>Overall MS formula score</td></tr>
</table></p>
    <h2 class="hasAnchor" id="sets-workflows"><a class="anchor" href="#sets-workflows"></a>Sets workflows</h2>

    <p>With a <a href='sets-workflow.html'>sets workflow</a>, annotation is first performed for each set.
  This is important, since the annotation algorithms typically cannot work with data from mixed ionization modes. The
  annotation results are then combined to generate a <em>sets consensus</em>:</p><ul>
<li><p>The annotation tables for each feature group from the set specific data are combined. Rows with overlapping
  candidates (determined by the neutral formula) are merged.</p></li>
<li><p>Set specific data (<em>e.g.</em> the ionic formula) is retained by renaming their columns with set specific
  names.</p></li>
<li><p>The MS/MS fragment annotations (<code>fragInfo</code> column) from each set are combined.</p></li>
<li><p>The scorings for each set are averaged to calculate overall scores.</p></li>
<li><p>The candidates are re-ranked based on their average ranking among the set data (if a candidate is absent in a
  set it is assigned the poorest rank in that set).</p></li>
<li><p>The coverage of each candidate among sets is calculated. Depending on the <code>setThreshold</code> and
  <code>setThresholdAnn</code> arguments, candidates with low abundance are removed.</p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>The <code><a href='formulas-class.html'>formulas</a></code> output class and its methods and the algorithm specific functions:
  <code><a href='generateFormulasDA.html'>generateFormulasDA</a></code>, <code><a href='generateFormulasGenForm.html'>generateFormulasGenForm</a></code>, <code><a href='generateFormulasSIRIUS.html'>generateFormulasSIRIUS</a></code></p>
<p>The <a href='https://www.researchgate.net/publication/307964728_MOLGEN-MSMS_Software_User_Manual'>GenForm
  manual</a> (also known as MOLGEN-MSMS).</p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Rick Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


