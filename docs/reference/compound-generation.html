<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Automatic compound identification — compound-generation • patRoon</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Automatic compound identification — compound-generation" />
<meta property="og:description" content="Functionality to automatically identify chemical compounds from feature groups." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patRoon</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Reference
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../reference/index.html">Online</a>
    </li>
    <li>
      <a href="../reference/patRoon.pdf">PDF</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorial
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/tutorial.html">Online HTML page</a>
    </li>
    <li>
      <a href="../articles/tutorial.pdf">PDF</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Handbook
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../handbook_bd/index.html">Book format</a>
    </li>
    <li>
      <a href="../articles/handbook.html">Single page</a>
    </li>
    <li>
      <a href="../handbook_bd/handbook.pdf">PDF</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rickhelmus/patRoon">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Automatic compound identification</h1>
    <small class="dont-index">Source: <a href='https://github.com/rickhelmus/patRoon/blob/master/R/main.R'><code>R/main.R</code></a>, <a href='https://github.com/rickhelmus/patRoon/blob/master/R/compounds.R'><code>R/compounds.R</code></a>, <a href='https://github.com/rickhelmus/patRoon/blob/master/R/utils-compounds.R'><code>R/utils-compounds.R</code></a>, and 2 more</small>
    <div class="hidden name"><code>compound-generation.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Functionality to automatically identify chemical compounds from feature groups.</p>
    </div>

    <pre class="usage"><span class='co'># S4 method for featureGroups</span>
<span class='fu'>generateCompounds</span><span class='op'>(</span><span class='va'>fGroups</span>, <span class='va'>MSPeakLists</span>, <span class='va'>algorithm</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>compoundScorings</span><span class='op'>(</span>
  algorithm <span class='op'>=</span> <span class='cn'>NULL</span>,
  database <span class='op'>=</span> <span class='cn'>NULL</span>,
  includeSuspectLists <span class='op'>=</span> <span class='cn'>TRUE</span>,
  onlyDefault <span class='op'>=</span> <span class='cn'>FALSE</span>,
  includeNoDB <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>

<span class='co'># S4 method for featureGroups</span>
<span class='fu'>generateCompoundsMetFrag</span><span class='op'>(</span>
  <span class='va'>fGroups</span>,
  <span class='va'>MSPeakLists</span>,
  method <span class='op'>=</span> <span class='st'>"CL"</span>,
  timeout <span class='op'>=</span> <span class='fl'>300</span>,
  timeoutRetries <span class='op'>=</span> <span class='fl'>2</span>,
  errorRetries <span class='op'>=</span> <span class='fl'>2</span>,
  topMost <span class='op'>=</span> <span class='fl'>100</span>,
  dbRelMzDev <span class='op'>=</span> <span class='fl'>5</span>,
  fragRelMzDev <span class='op'>=</span> <span class='fl'>5</span>,
  fragAbsMzDev <span class='op'>=</span> <span class='fl'>0.002</span>,
  adduct <span class='op'>=</span> <span class='cn'>NULL</span>,
  database <span class='op'>=</span> <span class='st'>"pubchem"</span>,
  extendedPubChem <span class='op'>=</span> <span class='st'>"auto"</span>,
  chemSpiderToken <span class='op'>=</span> <span class='st'>""</span>,
  scoreTypes <span class='op'>=</span> <span class='fu'>compoundScorings</span><span class='op'>(</span><span class='st'>"metfrag"</span>, <span class='va'>database</span>, onlyDefault <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>$</span><span class='va'>name</span>,
  scoreWeights <span class='op'>=</span> <span class='fl'>1</span>,
  preProcessingFilters <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"UnconnectedCompoundFilter"</span>, <span class='st'>"IsotopeFilter"</span><span class='op'>)</span>,
  postProcessingFilters <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"InChIKeyFilter"</span><span class='op'>)</span>,
  maxCandidatesToStop <span class='op'>=</span> <span class='fl'>2500</span>,
  identifiers <span class='op'>=</span> <span class='cn'>NULL</span>,
  extraOpts <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span>

<span class='co'># S4 method for featureGroupsSet</span>
<span class='fu'>generateCompoundsMetFrag</span><span class='op'>(</span>
  <span class='va'>fGroups</span>,
  <span class='va'>MSPeakLists</span>,
  method <span class='op'>=</span> <span class='st'>"CL"</span>,
  timeout <span class='op'>=</span> <span class='fl'>300</span>,
  timeoutRetries <span class='op'>=</span> <span class='fl'>2</span>,
  errorRetries <span class='op'>=</span> <span class='fl'>2</span>,
  topMost <span class='op'>=</span> <span class='fl'>100</span>,
  dbRelMzDev <span class='op'>=</span> <span class='fl'>5</span>,
  fragRelMzDev <span class='op'>=</span> <span class='fl'>5</span>,
  fragAbsMzDev <span class='op'>=</span> <span class='fl'>0.002</span>,
  adduct <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>,
  setThreshold <span class='op'>=</span> <span class='fl'>0</span>,
  setThresholdAnn <span class='op'>=</span> <span class='fl'>0</span>
<span class='op'>)</span>

<span class='co'># S4 method for featureGroups</span>
<span class='fu'>generateCompoundsSIRIUS</span><span class='op'>(</span>
  <span class='va'>fGroups</span>,
  <span class='va'>MSPeakLists</span>,
  relMzDev <span class='op'>=</span> <span class='fl'>5</span>,
  adduct <span class='op'>=</span> <span class='cn'>NULL</span>,
  elements <span class='op'>=</span> <span class='st'>"CHNOP"</span>,
  profile <span class='op'>=</span> <span class='st'>"qtof"</span>,
  formulaDatabase <span class='op'>=</span> <span class='cn'>NULL</span>,
  fingerIDDatabase <span class='op'>=</span> <span class='st'>"pubchem"</span>,
  noise <span class='op'>=</span> <span class='cn'>NULL</span>,
  errorRetries <span class='op'>=</span> <span class='fl'>2</span>,
  cores <span class='op'>=</span> <span class='cn'>NULL</span>,
  topMost <span class='op'>=</span> <span class='fl'>100</span>,
  topMostFormulas <span class='op'>=</span> <span class='fl'>5</span>,
  extraOptsGeneral <span class='op'>=</span> <span class='cn'>NULL</span>,
  extraOptsFormula <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  splitBatches <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='co'># S4 method for featureGroupsSet</span>
<span class='fu'>generateCompoundsSIRIUS</span><span class='op'>(</span>
  <span class='va'>fGroups</span>,
  <span class='va'>MSPeakLists</span>,
  relMzDev <span class='op'>=</span> <span class='fl'>5</span>,
  adduct <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>,
  setThreshold <span class='op'>=</span> <span class='fl'>0</span>,
  setThresholdAnn <span class='op'>=</span> <span class='fl'>0</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>fGroups</th>
      <td><p><code><a href='featureGroups-class.html'>featureGroups</a></code> object for which compounds should be identified. This should be the same
or a subset of the object that was used to create the specified <code>MSPeakLists</code>. In the case of a subset only
the remaining feature groups in the subset are considered.</p></td>
    </tr>
    <tr>
      <th>MSPeakLists</th>
      <td><p>A <code><a href='MSPeakLists-class.html'>MSPeakLists</a></code> object that was generated for the supplied <code>fGroups</code>.</p></td>
    </tr>
    <tr>
      <th>algorithm</th>
      <td><p>A character string describing the algorithm that should be
used: <code>"metfrag"</code>, <code>"sirius"</code></p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Any parameters to be passed to the selected compound generation algorithm.</p>
<p>For sets workflows: further arguments directly passed to the non-sets method.</p></td>
    </tr>
    <tr>
      <th>database</th>
      <td><p>Compound database to use. Valid values are: <code>"pubchem"</code>,
<code>"chemspider"</code>, <code>"for-ident"</code>, <code>"comptox"</code>,
<code>"pubchemlite"</code>, <code>"kegg"</code>, <code>"sdf"</code>, <code>"psv"</code> and
<code>"csv"</code>. See section below for more information. Sets the
<code>MetFragDatabaseType</code> option.</p></td>
    </tr>
    <tr>
      <th>includeSuspectLists, onlyDefault, includeNoDB</th>
      <td><p>A logical specifying
whether scoring terms related to suspect lists, default scoring terms and
non-database specific scoring terms should be included in the output,
respectively.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Which method should be used for MetFrag execution: <code>"CL"</code>
for <code class='command'>MetFragCL</code> and <code>"R"</code> for <code class='command'>MetFragR</code>. The former
might be faster.</p></td>
    </tr>
    <tr>
      <th>timeout</th>
      <td><p>Maximum time (in seconds) before a metFrag query for a feature
group is stopped. Also see <code>timeoutRetries</code> argument.</p></td>
    </tr>
    <tr>
      <th>timeoutRetries</th>
      <td><p>Maximum number of retries after reaching a timeout
before completely skipping the metFrag query for a feature group. Also see
<code>timeout</code> argument.</p></td>
    </tr>
    <tr>
      <th>errorRetries</th>
      <td><p>Maximum number of retries after an error occurred. This may be useful to handle e.g. connection
errors.</p></td>
    </tr>
    <tr>
      <th>topMost</th>
      <td><p>Only keep this number of candidates (per feature group) with highest score. Set to <code>NULL</code> to
always keep all candidates, however, please note that this may result in significant usage of CPU/RAM resources for
large numbers of candidates.</p></td>
    </tr>
    <tr>
      <th>dbRelMzDev</th>
      <td><p>Relative mass deviation (in ppm) for database search. Sets
the <span class="option">DatabaseSearchRelativeMassDeviation</span> option.</p></td>
    </tr>
    <tr>
      <th>fragRelMzDev</th>
      <td><p>Relative mass deviation (in ppm) for fragment matching.
Sets the <span class="option">FragmentPeakMatchRelativeMassDeviation</span> option.</p></td>
    </tr>
    <tr>
      <th>fragAbsMzDev</th>
      <td><p>Absolute mass deviation (in Da) for fragment matching.
Sets the <span class="option">FragmentPeakMatchAbsoluteMassDeviation</span> option.</p></td>
    </tr>
    <tr>
      <th>adduct</th>
      <td><p>An <code><a href='adduct-class.html'>adduct</a></code> object (or something that can be converted to it with <code><a href='adduct-utils.html'>as.adduct</a></code>).
  Examples: <code>"[M-H]-"</code>, <code>"[M+Na]+"</code>. If the <code>featureGroups</code> object has
  adduct annotations then these are used if <code>adducts=NULL</code>.</p>
<p>(<strong>sets workflow</strong>) The <code>adduct</code> argument is not supported for sets workflows, since the
  adduct annotations will then always be used.</p></td>
    </tr>
    <tr>
      <th>extendedPubChem</th>
      <td><p>If <code>database="pubchem"</code>: whether to use the
<em>extended</em> database that includes information for compound scoring
(<em>i.e.</em> number of patents/PubMed references). Note that downloading
candidates from this database might take extra time. Valid values are:
<code>FALSE</code> (never use it), <code>TRUE</code> (always use it) or <code>"auto"</code>
(default, use if specified scorings demand it).</p></td>
    </tr>
    <tr>
      <th>chemSpiderToken</th>
      <td><p>A character string with the
<a href='http://www.chemspider.com/AboutServices.aspx'>ChemSpider security
token</a> that should be set when the ChemSpider database is used. Sets the
<span class="option">ChemSpiderToken</span> option.</p></td>
    </tr>
    <tr>
      <th>scoreTypes</th>
      <td><p>A character vector defining the scoring types. See the
<code>Scorings</code> section below for more information. Note that both generic
and <code class='command'>MetFrag</code> specific names are accepted (<em>i.e.</em> <code>name</code>
and <code>metfrag</code> columns returned by <code>compoundScorings</code>). When a
local database is used, the name should match what is given there
(<code>e.g</code> column names when <code>database=csv</code>). Note that MetFrag may
still report other scoring data, however, these are not used for ranking.
Sets the <span class="option">MetFragScoreTypes</span> option.</p></td>
    </tr>
    <tr>
      <th>scoreWeights</th>
      <td><p>Numeric vector containing weights of the used scoring
types. Order is the same as set in <code>scoreTypes</code>. Values are recycled
if necessary. Sets the <span class="option">MetFragScoreWeights</span> option.</p></td>
    </tr>
    <tr>
      <th>preProcessingFilters, postProcessingFilters</th>
      <td><p>A character vector defining
pre/post filters applied before/after fragmentation and scoring
(<em>e.g.</em> <code>"UnconnectedCompoundFilter"</code>, <code>"IsotopeFilter"</code>,
<code>"ElementExclusionFilter"</code>). Some methods require further options to
be set. For all filters and more information refer to the <code>Candidate
Filters</code> section on the
<a href='http://ipb-halle.github.io/MetFrag/projects/metfragr/'>MetFragR
homepage</a>. Sets the <span class="option">MetFragPreProcessingCandidateFilter</span> and
<code>MetFragPostProcessingCandidateFilter</code> options.</p></td>
    </tr>
    <tr>
      <th>maxCandidatesToStop</th>
      <td><p>If more than this number of candidate structures
are found then processing will be aborted and no results this feature group
will be reported. Low values increase the chance of missing data, whereas
too high values will use too much computer resources and signficantly
slowdown the process. Sets the <span class="option">MaxCandidateLimitToStop</span> option.</p></td>
    </tr>
    <tr>
      <th>identifiers</th>
      <td><p>A <code>list</code> containing for each feature group a
character vector with database identifiers that should be used to find
candidates for a feature group (the list should be named by feature group
names). If <code>NULL</code> all relevant candidates will be retrieved from the
specified database. An example usage scenario is to obtain the list of
candidate identifiers from a <code><a href='compounds-class.html'>compounds</a></code> object obtained with
<code>generateCompoundsSIRIUS</code> using the <code><a href='compounds-class.html'>identifiers</a></code>
method. This way, only those candidates will be searched by MetFrag that
were generated by SIRIUS+CSI:FingerID. Sets the
<span class="option">PrecursorCompoundIDs</span> option.</p></td>
    </tr>
    <tr>
      <th>extraOpts</th>
      <td><p>For <code class='command'>MetFrag</code>: A named <code>list</code> containing further settings to be passed to
  <code>run.metfrag</code>. See the <a href='http://ipb-halle.github.io/MetFrag/projects/metfragr/'>MetFragR</a>
  and <a href='http://ipb-halle.github.io/MetFrag/projects/metfragcl/'>MetFrag CL</a> homepages for all available options.</p>
<p>For <code class='command'>SIRIUS</code>: a <code>character</code> vector with any extra commandline parameters for formula prediction. See
  the SIRIUS manual for more details.</p>
<p>Set to <code>NULL</code> to ignore.</p></td>
    </tr>
    <tr>
      <th>setThreshold</th>
      <td><p>(<strong>sets workflow</strong>) Minimum abundance for a candidate among all sets (<samp>0-1</samp>). For instance, a value of
<samp>1</samp> means that the candidate needs to be present in all the set data.</p></td>
    </tr>
    <tr>
      <th>setThresholdAnn</th>
      <td><p>(<strong>sets workflow</strong>) As <code>setThreshold</code>, but only taking into account the set data that contain
annotations for the feature group of the candidate.</p></td>
    </tr>
    <tr>
      <th>relMzDev</th>
      <td><p>Maximum relative deviation between the measured and candidate
formula <em>m/z</em> values (in ppm). Sets the <span class="option">--ppm-max</span> commandline
option.</p></td>
    </tr>
    <tr>
      <th>elements</th>
      <td><p>Elements to be considered for formulae calculation. This will
heavily affects the number of candidates! Always try to work with a minimal
set by excluding elements you don't expect. The minimum/maximum number
of elements can also be specified, for example: a value of
<code>"C[5]H[10-15]O"</code> will only consider formulae with up to five carbon
atoms, between ten and fifteen hydrogen atoms and any amount of oxygen
atoms. Sets the <span class="option">--elements</span> commandline option.</p></td>
    </tr>
    <tr>
      <th>profile</th>
      <td><p>Name of the configuration profile, for example: <span class="option">"qtof"</span>, <span class="option">"orbitrap"</span>,
<span class="option">"fticr"</span>. Sets the <span class="option">--profile</span> commandline option.</p></td>
    </tr>
    <tr>
      <th>formulaDatabase</th>
      <td><p>If not <code>NULL</code>, use a database for retrieval of formula
candidates. Possible values are: <span class="option">"pubchem"</span>, <span class="option">"bio"</span>, <span class="option">"kegg"</span>, <span class="option">"hmdb"</span>. Sets the
<span class="option">--database</span> commandline option.</p></td>
    </tr>
    <tr>
      <th>fingerIDDatabase</th>
      <td><p>Database specifically used for
<code class='command'>CSI:FingerID</code>. If <code>NULL</code>, the value of the
<code>formulaDatabase</code> parameter will be used or <code>"pubchem"</code> when that
is also <code>NULL</code>. Sets the <span class="option">--fingerid-db</span> option.</p></td>
    </tr>
    <tr>
      <th>noise</th>
      <td><p>Median intensity of the noise (<code>NULL</code> ignores this parameter). Sets the <span class="option">--noise</span>
commandline option.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>The number of cores <code class='command'>SIRIUS</code> will use. If <code>NULL</code> then the default of all cores will be
used.</p></td>
    </tr>
    <tr>
      <th>topMostFormulas</th>
      <td><p>Do not return more than this number of candidate
formulae. Note that only compounds for these formulae will be searched.
Sets the <span class="option">--candidates</span> commandline option.</p></td>
    </tr>
    <tr>
      <th>extraOptsGeneral, extraOptsFormula</th>
      <td><p>a <code>character</code> vector with any extra commandline parameters for
<code class='command'>SIRIUS</code>. For <code class='command'>SIRIUS</code> versions <code>&lt;4.4</code> there is no distinction between general and formula
options. Otherwise commandline options specified in <code>extraOptsGeneral</code> are added prior to the <code>formula</code>
command, while options specified in <code>extraOptsFormula</code> are added in afterwards. See the <code class='command'>SIRIUS</code>
manual for more details. Set to <code>NULL</code> to ignore.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>If <code>TRUE</code> then more output is shown in the terminal.</p></td>
    </tr>
    <tr>
      <th>splitBatches</th>
      <td><p>If <code>TRUE</code> then the calculations done by <code class='command'>SIRIUS</code> will be evenly split over multiple
<code class='command'>SIRIUS</code> calls (which may be run in parallel depending on the <a href='patRoon-package.html'>set package
options</a>). If <code>splitBatches=FALSE</code> then all feature calculations are performed from a single <code class='command'>SIRIUS</code>
execution, which is often the fastest if calculations are performed on a single computer.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>compoundScorings</code> returns a <code>data.frame</code> with information
  on which scoring terms are used, what their algorithm specific name is and
  other information such as to which database they apply and short remarks.</p>
<p><code>generateCompoundsMetFrag</code> returns a <code><a href='compoundsMF-class.html'>compoundsMF</a></code>
  object.</p>
<p><code>generateCompoundsSIRIUS</code> returns a <code><a href='compounds-class.html'>compounds</a></code>
  object.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Several algorithms are provided to automatically identify compounds for given feature groups. To this end, each
measured masses for all feature groups are searched within online database(s) (<em>e.g.</em>
<a href='https://pubchem.ncbi.nlm.nih.gov/'>PubChem</a>) to retrieve a list of potential candidate chemical compounds.
Depending on the algorithm and its parameters, further scoring of candidates is then performed using, for instance,
matching of measured and theoretical isotopic patterns, presence within other data sources such as patent databases
and similarity of measured and in-silico predicted MS/MS fragments. Note that this process is often quite time
consuming, especially for large feature group sets. Therefore, this is often one of the last steps within the
workflow and not performed before feature groups have been prioritized.</p>
<p><code>generateCompounds</code> is a generic function that will generate compounds using one of the supported algorithms. The actual
  functionality is provided by algorithm specific functions such as <code>generateCompoundsMetFrag</code> and <code>generateCompoundsSIRIUS</code>. While these
  functions may be called directly, <code>generateCompounds</code> provides a generic interface and is therefore usually preferred.</p>
<p><code>compoundScorings</code> displays an overview of scorings may be
  applied to rank candidate compounds (see <code>Scorings</code> section below).</p>
<p><code>generateCompoundsMetFrag</code> uses the <span class="pkg">metfRag</span> package or
  <code class='command'>MetFrag CL</code> for compound identification (see
  <a href='http://ipb-halle.github.io/MetFrag/'>http://ipb-halle.github.io/MetFrag/</a>). Several online compound
  databases such as <a href='https://pubchem.ncbi.nlm.nih.gov/'>PubChem</a> and
  <a href='http://www.chemspider.com/'>ChemSpider</a> may be chosen for retrieval
  of candidate structures. In addition, many options exist to score and
  filter resulting data, and it is highly suggested to optimize these to
  improve results. While MS/MS data is not mandatory, it will usually greatly
  improve candidate scoring. The <code class='command'>MetFrag</code> options <code>PeakList</code>,
  <code>IonizedPrecursorMass</code> and <code>ExperimentalRetentionTimeValue</code> (in
  minutes) fields are automatically set from feature data.</p>
<p><code>generateCompoundsSIRIUS</code> uses
  <a href='https://bio.informatik.uni-jena.de/software/sirius/'>SIRIUS</a> in
  combination with <a href='https://www.csi-fingerid.uni-jena.de/'>CSI:FingerID</a>
  for compound identification. Similar to
  <code><a href='formula-generation.html'>generateFormulasSIRIUS</a></code>, candidate formulae are generated with
  SIRIUS. These results are then feed to CSI:FingerID to acquire candidate
  structures. This method requires the availability
  of MS/MS data, and feature groups without it will be ignored.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>For annotations performed with <code class='command'>SIRIUS</code> it is often the fastest to keep the default
  <code>splitBatches=FALSE</code>. In this case, all <code class='command'>SIRIUS</code> output will be printed to the terminal (unless
  <code>verbose=FALSE</code> or <span class="option">patRoon.MP.method="future"</span>). Furthermore, please note that only annotations to be
  performed for the same adduct are grouped in a single batch execution.</p>
    <h2 class="hasAnchor" id="scorings"><a class="anchor" href="#scorings"></a>Scorings</h2>

    <p>Each algorithm implements their own scoring system. Their names have been simplified and
  harmonized where possible and are used for reporting and in the case <code class='command'>MetFrag</code> is used to specify how
  compounds should be scored (<code>scoreTypes</code> argument). The <code>compoundScorings</code> function can be used to get an
  overview of both the algorithm specific and generic scoring names. For instance, the table below shows all scorings
  for <code class='command'>MetFrag</code>: (some columns are omitted)</p>
<p></p><table class='table'>
<tr><td><strong>name</strong></td><td><strong>metfrag</strong></td><td><strong>database</strong></td></tr>
<tr><td>score</td><td>Score</td><td></td></tr>
<tr><td>fragScore</td><td>FragmenterScore</td><td></td></tr>
<tr><td>metFusionScore</td><td>OfflineMetFusionScore</td><td></td></tr>
<tr><td>individualMoNAScore</td><td>OfflineIndividualMoNAScore</td><td></td></tr>
<tr><td>numberPatents</td><td>PubChemNumberPatents</td><td>pubchem</td></tr>
<tr><td>numberPatents</td><td>Patent_Count</td><td>pubchemlite</td></tr>
<tr><td>pubMedReferences</td><td>PubChemNumberPubMedReferences</td><td>pubchem</td></tr>
<tr><td>pubMedReferences</td><td>ChemSpiderNumberPubMedReferences</td><td>chemspider</td></tr>
<tr><td>pubMedReferences</td><td>NUMBER_OF_PUBMED_ARTICLES</td><td>comptox</td></tr>
<tr><td>pubMedReferences</td><td>PubMed_Count</td><td>pubchemlite</td></tr>
<tr><td>extReferenceCount</td><td>ChemSpiderNumberExternalReferences</td><td>chemspider</td></tr>
<tr><td>dataSourceCount</td><td>ChemSpiderDataSourceCount</td><td>chemspider</td></tr>
<tr><td>referenceCount</td><td>ChemSpiderReferenceCount</td><td>chemspider</td></tr>
<tr><td>RSCCount</td><td>ChemSpiderRSCCount</td><td>chemspider</td></tr>
<tr><td>smartsInclusionScore</td><td>SmartsSubstructureInclusionScore</td><td></td></tr>
<tr><td>smartsExclusionScore</td><td>SmartsSubstructureExclusionScore</td><td></td></tr>
<tr><td>suspectListScore</td><td>SuspectListScore</td><td></td></tr>
<tr><td>retentionTimeScore</td><td>RetentionTimeScore</td><td></td></tr>
<tr><td>CPDATCount</td><td>CPDAT_COUNT</td><td>comptox</td></tr>
<tr><td>TOXCASTActive</td><td>TOXCAST_PERCENT_ACTIVE</td><td>comptox</td></tr>
<tr><td>dataSources</td><td>DATA_SOURCES</td><td>comptox</td></tr>
<tr><td>pubChemDataSources</td><td>PUBCHEM_DATA_SOURCES</td><td>comptox</td></tr>
<tr><td>EXPOCASTPredExpo</td><td>EXPOCAST_MEDIAN_EXPOSURE_PREDICTION_MG/KG-BW/DAY</td><td>comptox</td></tr>
<tr><td>ECOTOX</td><td>ECOTOX</td><td>comptox</td></tr>
<tr><td>NORMANSUSDAT</td><td>NORMANSUSDAT</td><td>comptox</td></tr>
<tr><td>MASSBANKEU</td><td>MASSBANKEU</td><td>comptox</td></tr>
<tr><td>TOX21SL</td><td>TOX21SL</td><td>comptox</td></tr>
<tr><td>TOXCAST</td><td>TOXCAST</td><td>comptox</td></tr>
<tr><td>KEMIMARKET</td><td>KEMIMARKET</td><td>comptox</td></tr>
<tr><td>MZCLOUD</td><td>MZCLOUD</td><td>comptox</td></tr>
<tr><td>pubMedNeuro</td><td>PubMedNeuro</td><td>comptox</td></tr>
<tr><td>CIGARETTES</td><td>CIGARETTES</td><td>comptox</td></tr>
<tr><td>INDOORCT16</td><td>INDOORCT16</td><td>comptox</td></tr>
<tr><td>SRM2585DUST</td><td>SRM2585DUST</td><td>comptox</td></tr>
<tr><td>SLTCHEMDB</td><td>SLTCHEMDB</td><td>comptox</td></tr>
<tr><td>THSMOKE</td><td>THSMOKE</td><td>comptox</td></tr>
<tr><td>ITNANTIBIOTIC</td><td>ITNANTIBIOTIC</td><td>comptox</td></tr>
<tr><td>STOFFIDENT</td><td>STOFFIDENT</td><td>comptox</td></tr>
<tr><td>KEMIMARKET_EXPO</td><td>KEMIMARKET_EXPO</td><td>comptox</td></tr>
<tr><td>KEMIMARKET_HAZ</td><td>KEMIMARKET_HAZ</td><td>comptox</td></tr>
<tr><td>REACH2017</td><td>REACH2017</td><td>comptox</td></tr>
<tr><td>KEMIWW_WDUIndex</td><td>KEMIWW_WDUIndex</td><td>comptox</td></tr>
<tr><td>KEMIWW_StpSE</td><td>KEMIWW_StpSE</td><td>comptox</td></tr>
<tr><td>KEMIWW_SEHitsOverDL</td><td>KEMIWW_SEHitsOverDL</td><td>comptox</td></tr>
<tr><td>ZINC15PHARMA</td><td>ZINC15PHARMA</td><td>comptox</td></tr>
<tr><td>PFASMASTER</td><td>PFASMASTER</td><td>comptox</td></tr>
<tr><td>peakFingerprintScore</td><td>AutomatedPeakFingerprintAnnotationScore</td><td></td></tr>
<tr><td>lossFingerprintScore</td><td>AutomatedLossFingerprintAnnotationScore</td><td></td></tr>
<tr><td>agroChemInfo</td><td>AgroChemInfo</td><td>pubchemlite</td></tr>
<tr><td>bioPathway</td><td>BioPathway</td><td>pubchemlite</td></tr>
<tr><td>drugMedicInfo</td><td>DrugMedicInfo</td><td>pubchemlite</td></tr>
<tr><td>foodRelated</td><td>FoodRelated</td><td>pubchemlite</td></tr>
<tr><td>pharmacoInfo</td><td>PharmacoInfo</td><td>pubchemlite</td></tr>
<tr><td>safetyInfo</td><td>SafetyInfo</td><td>pubchemlite</td></tr>
<tr><td>toxicityInfo</td><td>ToxicityInfo</td><td>pubchemlite</td></tr>
<tr><td>knownUse</td><td>KnownUse</td><td>pubchemlite</td></tr>
<tr><td>disorderDisease</td><td>DisorderDisease</td><td>pubchemlite</td></tr>
<tr><td>identification</td><td>Identification</td><td>pubchemlite</td></tr>
<tr><td>annoTypeCount</td><td>FPSum</td><td>pubchemlite</td></tr>
<tr><td>annoTypeCount</td><td>AnnoTypeCount</td><td>pubchemlite</td></tr>
</table>


<p>In addition, the <code>compoundScorings</code> function is also useful to programatically generate  a
  set of scorings to be used by <code class='command'>MetFrag</code>. For instance, the following can be given to the <code>scoreTypes</code>
  argument to use all default scorings for PubChem: <code>compoundScorings("metfrag", "pubchem",
  onlyDefault=TRUE)$name</code>.</p>
<p>For all <code class='command'>MetFrag</code> scoring types refer to the <code>Candidate Scores</code> section on the
  <a href='http://ipb-halle.github.io/MetFrag/projects/metfragr/'>MetFragR homepage</a>.</p>
    <h2 class="hasAnchor" id="sets-workflows"><a class="anchor" href="#sets-workflows"></a>Sets workflows</h2>

    <p>With a <a href='sets-workflow.html'>sets workflow</a>, annotation is first performed for each set.
  This is important, since the annotation algorithms typically cannot work with data from mixed ionization modes. The
  annotation results are then combined to generate a <em>sets consensus</em>:</p><ul>
<li><p>The annotation tables for each feature group from the set specific data are combined. Rows with overlapping
  candidates (determined by the first-block <acronym>InChIKey</acronym>) are merged.</p></li>
<li><p>Set specific data (<em>e.g.</em> the ionic formula) is retained by renaming their columns with set specific
  names.</p></li>
<li><p>The MS/MS fragment annotations (<code>fragInfo</code> column) from each set are combined.</p></li>
<li><p>The scorings for each set are averaged to calculate overall scores.</p></li>
<li><p>The candidates are re-ranked based on their average ranking among the set data (if a candidate is absent in a
  set it is assigned the poorest rank in that set).</p></li>
<li><p>The coverage of each candidate among sets is calculated. Depending on the <code>setThreshold</code> and
  <code>setThresholdAnn</code> arguments, candidates with low abundance are removed.</p></li>
</ul>

    <h2 class="hasAnchor" id="parallelization"><a class="anchor" href="#parallelization"></a>Parallelization</h2>

    <p><code>generateCompoundsMetFrag</code> and <code>generateCompoundsSIRIUS</code> uses multiprocessing to parallelize
  computations. Please see the parallelization section in the handbook for
  more details and <a href='patRoon-package.html'>patRoon options</a> for configuration
  options.</p>
<p>When local database files are used with
  <code>generateCompoundsMetFrag</code> (<em>e.g.</em> when <code>database</code> is set to
  <code>"pubchemlite"</code>, <code>"csv"</code> etc.) and
  <span class="option">patRoon.MP.method="future"</span>, then the database file must be present
  on all the nodes. When <code>pubchemlite</code> or <code>comptox</code> is used, the
  location for these databases can be configured on the host with the
  respective package options (<span class="option">patRoon.path.MetFragPubChemLite</span> and
  <span class="option">patRoon.path.MetFragCompTox</span>). Note that these files must
  <em>also</em> be present on the local host computer, even if it is not
  participating in computations.</p>
    <h2 class="hasAnchor" id="usage-of-metfrag-databases"><a class="anchor" href="#usage-of-metfrag-databases"></a>Usage of MetFrag databases</h2>

    <p>When <code>database="chemspider"</code>
  setting the <code>chemSpiderToken</code> argument is mandatory.</p>
<p>When a local database is set (<em>i.e.</em> <code>sdf</code>, <code>psv</code>,
  <code>csv</code>, <code>comptox</code>, <code>pubchemlite</code>) the file location of the
  database should be set in the <code>LocalDatabasePath</code> value via the
  <code>extraOpts</code> argument or using the
  <code>patRoon.path.MetFragCompTox</code>/<code>patRoon.path.MetFragPubChemLite</code>
  option (only when <code>database="comptox"</code> or
  <code>database="pubchemlite"</code>).</p>
<p>Examples: <code>options(patRoon.path.MetFragCompTox =
  "C:/CompTox_17March2019_SelectMetaData.csv")</code> <code>extraOpts =
  list(LocalDatabasePath = "C:/myDB.csv")</code>.</p>
<p>For <code>database="comptox"</code> the files can be obtained from
  <a href='ftp://newftp.epa.gov/COMPTOX/Sustainable_Chemistry_Data/Chemistry_Dashboard/MetFrag_metadata_files'>here</a>.
   Furthermore, the files with additions for
  <a href='smoking'>https://zenodo.org/record/3364464#.XnjM-XLvKUk</a> and
  <a href='wastewater'>https://zenodo.org/record/3472781#.XnjMAHLvKUk</a> metadata
  are also supported. Note that only recent <code class='command'>MetFrag</code> versions (&gt;=
  <samp>2.4.5</samp>) support these libraries.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Ruttkies C, Schymanski EL, Wolf S, Hollender J, Neumann S (2016).
&#8220;MetFrag relaunched: incorporating strategies beyond in silico fragmentation.&#8221;
<em>Journal of Cheminformatics</em>, <b>8</b>(1).
doi: <a href='https://doi.org/10.1186/s13321-016-0115-9'>10.1186/s13321-016-0115-9</a>
.</p>
<p>Duhrkop K, Fleischauer M, Ludwig M, Aksenov AA, Melnik AV, Meusel M, Dorrestein PC, Rousu J, Bocker S (2019).
&#8220;SIRIUS 4: a rapid tool for turning tandem mass spectra into metabolite structure information.&#8221;
<em>Nature Methods</em>, <b>16</b>(4), 299--302.
doi: <a href='https://doi.org/10.1038/s41592-019-0344-8'>10.1038/s41592-019-0344-8</a>
.
 <br /><br /> Duhrkop K, Bocker S (2015).
&#8220;Fragmentation Trees Reloaded.&#8221;
In Przytycka TM (ed.), <em>Research in Computational Molecular Biology</em>, 65--79.
ISBN 978-3-319-16706-0.
 <br /><br />
  Duhrkop K, Shen H, Meusel M, Rousu J, Bocker S (2015).
&#8220;Searching molecular structure databases with tandem mass spectra using CSI:FingerID.&#8221;
<em>Proceedings of the National Academy of Sciences</em>, <b>112</b>(41), 12580--12585.
doi: <a href='https://doi.org/10.1073/pnas.1509788112'>10.1073/pnas.1509788112</a>
.
 <br /><br /> Bocker S, Letzel MC, Liptak Z, Pervukhin A (2008).
&#8220;SIRIUS: decomposing isotope patterns for metabolite identification.&#8221;
<em>Bioinformatics</em>, <b>25</b>(2), 218--224.
doi: <a href='https://doi.org/10.1093/bioinformatics/btn603'>10.1093/bioinformatics/btn603</a>
.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='compounds-class.html'>compounds-class</a></code></p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Rick Helmus.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


